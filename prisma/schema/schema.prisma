generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
}

model bill {
  id               BigInt             @id @default(autoincrement())
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  project_expenses project_expenses[]
}

model material {
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  measurement_unit measurement_units
  stock_code       String             @id @db.VarChar
  description      String             @db.VarChar
  balance          Float
  project_expenses project_expenses[]
}

model project_expenses {
  id              BigInt          @id @default(autoincrement())
  created_at      DateTime        @default(now()) @db.Timestamptz(6)
  creator_id      BigInt
  bill_id         BigInt
  material_code   String          @db.VarChar
  total_cost      Decimal         @db.Decimal
  kdv_cost        Decimal         @db.Decimal
  project_id      BigInt
  bill            bill            @relation(fields: [bill_id], references: [id], onDelete: NoAction)
  user            user            @relation(fields: [creator_id], references: [id], onDelete: SetNull)
  material        material        @relation(fields: [material_code], references: [stock_code], onDelete: NoAction)
  treyler_project treyler_project @relation(fields: [project_id], references: [id], onDelete: NoAction)
}

model treyler_project {
  id               BigInt             @id @default(autoincrement())
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  creator_id       BigInt
  treyler_type_id  BigInt
  project_expenses project_expenses[]
  user             user               @relation(fields: [creator_id], references: [id], onDelete: SetNull)
  treyler_type     treyler_type       @relation(fields: [treyler_type_id], references: [id], onDelete: NoAction)
}

model treyler_type {
  id              BigInt            @id @default(autoincrement())
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  name            String            @db.VarChar
  treyler_project treyler_project[]
}

model user {
  id                 BigInt             @id @default(autoincrement())
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  username           String             @unique @db.VarChar
  hash_password      String             @db.VarChar
  name               String             @db.VarChar
  surname            String             @db.VarChar
  email              String             @db.VarChar
  authorization_ids  Int[]
  authorization_rank Int
  project_expenses   project_expenses[]
  treyler_project    treyler_project[]
}

model permissions {
  id          Int    @id @default(autoincrement())
  name        String @unique @db.VarChar
  description String @db.VarChar
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model role {
  id            BigInt  @id @default(autoincrement())
  name          String? @unique @db.VarChar
  description   String? @db.VarChar
  permissionIDs Int[]
}

enum measurement_units {
  kg
  meter
  liter
  box
  piece
}
